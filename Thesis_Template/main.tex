%############################################
%Page layout.
%############################################

%Modern book class, index and lists in toc, two sided layout, chapters start on both sides, 12 pt font.
\documentclass[index=totoc, bibliography=totoc,listof=totoc , twoside, openany,12pt]{scrbook} 


%Recover old font commands for older packages.
\makeatletter
\DeclareOldFontCommand{\rm}{\normalfont\rmfamily}{\mathrm}
\DeclareOldFontCommand{\sf}{\normalfont\sffamily}{\mathsf}
\DeclareOldFontCommand{\tt}{\normalfont\ttfamily}{\mathtt}
\DeclareOldFontCommand{\bf}{\normalfont\bfseries}{\mathbf}
\DeclareOldFontCommand{\it}{\normalfont\itshape}{\mathit}
\DeclareOldFontCommand{\sl}{\normalfont\slshape}{\@nomath\sl}
\DeclareOldFontCommand{\sc}{\normalfont\scshape}{\@nomath\sc}
\makeatother


%1.5 line spacing and fix for arrays and tables.
%\usepackage[onehalfspacing]{setspace}
%\setdisplayskipstretch{}
%\renewcommand{\arraystretch}{0.75}

%Scalable font similar to cm.
\usepackage{lmodern} 
 
%Sans serif font.
%\renewcommand{\familydefault}{\sfdefault} 
 
%Define margins and dimensions.
\usepackage[a4paper,includehead,bindingoffset=1cm,inner=2.0cm,outer = 2.5cm ,top=2cm,bottom=2.5cm]{geometry}   
 

 





%############################################
%Create header and footer.
%############################################ 
 
%The package.
\usepackage[automark]{scrlayer-scrpage}

%Clear predefined header and footer.
\pagestyle{scrheadings} \clearscrheadfoot 

%Line below header.
\KOMAoptions{headsepline=0.5pt:\textwidth}

%Inner header [plain]{regualr}.
\ihead[]{\headmark} 

%Outer header [plain]{regualr}.
\ohead[]{\thepage} 









%############################################
%Empty pages and title pages.
%############################################ 

%Write even/odd page-check-results to aux file with \checkoddpage. 
\usepackage{ifoddpage}


%Text on empty pages.
\newcommand*{\blankpage}{%
	\par\vspace*{\fill}%
	{\centering \textcolor{black!80}{This page intentionally left blank.}\par}%the text to be displayed
	\vspace{\fill}%
}
\makeatletter
\renewcommand*{\cleardoubleoddstandardpage}{%
	\clearpage
	\if@twoside
	\checkoddpage
	\ifodd\c@page
	\else
	\blankpage
	\thispagestyle{empty}%
	\newpage
	\if@twocolumn\hbox{}\newpage\fi
	\fi
	\fi
}
\makeatother


%Part command that allows for text on the same page.
%Defines \PartWithText{title}{text}.
\newcommand{\PartWithText}[2]{
\setpartpreamble[u,c][0.9 \textwidth]{
	\vspace{1cm}
	
	\noindent
	#2
	
}
\part{#1}
}













%############################################
%Adjust headings.
%############################################

%Print chapter number in separate line.
\KOMAoption{chapterprefix}{true}

%Define fonts for the chapter.
\RedeclareSectionCommand[afterindent=false,beforeskip=0pt, innerskip = 0pt,
font={\checkoddpage \ifoddpage \hfill \else \fi \huge\bfseries\fontfamily{bch}\selectfont},
prefixfont={\fontsize{85pt}{95pt}\color{black!20}\bfseries \selectfont}]{chapter}

%Style of chapter numbers.
\renewcommand*{\chapterformat}{\thechapter}

%Alignment of the chapter title.
\renewcommand*{\raggedchapter}{ \checkoddpage \ifoddpage \raggedleft \else \raggedright \fi }

%Layout of chapter content.
\renewcommand{\chapterlineswithprefixformat}[3]{%
	#2 %newlines already included 
	#3 
	\vspace{-1cm}
	\rule[-1\baselineskip]{\textwidth}{0.5pt}%
}

%Chapter spacings.
\renewcommand*{\chapterheadstartvskip}{\vspace{-60pt}}
\renewcommand*{\chapterheadendvskip}{\vspace{10pt}}





%Adjustments to sections.
\RedeclareSectionCommand[font={\Large \bfseries \fontfamily{bch}\selectfont}]{section}
\RedeclareSectionCommand[font={\large \bfseries \fontfamily{bch}\selectfont}]{subsection}
\RedeclareSectionCommand[font={\bfseries \fontfamily{bch}\selectfont}]{subsubsection}


%Intro text for chapters.
\newcommand{\ChapterStart}[1]{ {\small \sffamily \selectfont #1 }\\
	\rule{\textwidth}{0.5pt}}














%############################################
%Language settings.
%############################################

%Choosing default document language.
\usepackage[english]{babel} 

%Allow special characters.
\usepackage[utf8]{inputenc}	
\usepackage[T1]{fontenc}

%Optimization of micro spaces.
\usepackage{microtype}	











%############################################
%Colors and images.
%############################################

%Importing images.
\usepackage{graphicx} 

%More colors.
\usepackage[dvipsnames]{xcolor} 

%Caption improvements
%Use \captionof{floating_type, e.g. figure}[figure/table entry]{Text} to create numbered captions outside of floating environments.
\usepackage[font=footnotesize,format=plain, bf]{caption} 

%More than one image in figure environments.
\usepackage[font=footnotesize]{subcaption} 

%Wrap text around figures.
\usepackage{wrapfig} 

%Colored frames in equations.
\usepackage{empheq}

%Tikz/pgf package to program graphics.
\usepackage{tikz} 

%Some useful libraries. Babel to fix problems with babel package.
\usetikzlibrary{positioning, calc, intersections, cd, babel} 
\usepackage{tikz-3dplot}










%############################################
%Tables and lists.
%############################################

%Colors in tables.
\usepackage{colortbl} 

%Long tables that allows page breaks.
\usepackage{longtable} 

%Join cells in a row.
%\multicolumn{n}{cols}{text} already included. \multirow{n}{width, * for default size}{text} is added by the package.
\usepackage{multirow} 

%Additional counters for enumerations, e.g. [i)].
\usepackage{paralist} 






%############################################
%Mathematics.
%############################################

%Standard mathematics.
\usepackage{amsmath,amsthm,amsfonts,amssymb,mathtools} 

%\mathbbm{1} for unity operator.
\usepackage{bbm} 

%\nicefrac{}{} and units.
\usepackage{units} 

%Crossing out in formulas with \cancel{expression}.
\usepackage{cancel} 

%Shrinking formula in gather to fit page.
\usepackage{resizegather} 

%Tensor indices
\usepackage{tensor} 

%Fixes space around \ldots.
\usepackage{ellipsis}

%Frames for theorems.
\usepackage{tcolorbox}
\tcbuselibrary{skins,breakable}







%Page breakes in multiline formulas.
\allowdisplaybreaks 

%Bold mathematics in headings, etc..
\makeatletter
\g@addto@macro\bfseries{\boldmath}
\makeatother



%Definition of the usual theorem environments.

%\newtheoremstyle{name}{space above}{space below}{content format}{indent space}{caption format}{after caption}{space below caption}{}.

\newtheoremstyle{plain}{\topsep}{\topsep}{\itshape}{}{\bf}{.\ \\}{.5ex}{}
\newtheoremstyle{definition}{\topsep}{\topsep}{}{}{\bf}{.\ \\}{.5ex}{}
\newtheoremstyle{info}{\topsep}{\topsep}{}{}{\bfseries \normalsize }{.\ \\}{.5ex}{}


\theoremstyle{plain}
\newtheorem{thm}{Theorem}[section]
\newtheorem{cor}[thm]{Corollary}
\newtheorem{lemm}[thm]{Lemma}
\newtheorem{prop}[thm]{Proposition}

%Variable theorem name using \renewcommand{\VarThmName}{new name}.
\newcommand{\VarThmName}{VarThm} 
\newtheorem{VarThm}[thm]{\VarThmName}
\newtheorem{VarLemm}[thm]{\VarThmName}
\newtheorem{VarCor}[thm]{\VarThmName}

\theoremstyle{definition}
\newtheorem{deff}[thm]{Definition}
\newtheorem{prf}[thm]{Proof}
\newtheorem{VarDef}[thm]{\VarThmName}

\theoremstyle{info}
\newtheorem{rem}[thm]{Remark}
\newtheorem{exm}[thm]{Example}

%Frames for theorems.
\newtcolorbox{framedef}{enhanced, colback = gray!50!blue!15, borderline = {0.5pt}{0mm}{gray!90!blue}, leftrule = 4pt, toprule = 0pt, bottomrule = 0pt, rightrule = 0 pt, beforeafter skip= 1em, breakable, after={\noindent}}
\newtcolorbox{framethm}{enhanced, colback = gray!50!blue!25, borderline = {0.5pt}{0mm}{gray!90!blue},leftrule = 5pt, toprule = 0pt, bottomrule = 0pt, rightrule = 0 pt, beforeafter skip= 1em, breakable, after={\noindent}}
\newtcolorbox{framelemm}{enhanced, colback = gray!50!blue!10, borderline = {0.5pt}{0mm}{gray!90!blue}, leftrule = 2pt, toprule = 0pt, bottomrule = 0pt, rightrule = 0 pt ,beforeafter skip= 1em, breakable, after={\noindent}}
\newtcolorbox{framecor}{enhanced, colback = gray!50!blue!6, borderline = {0.5pt}{0mm}{gray!90!blue}, leftrule = 0pt, toprule = 0pt, bottomrule = 0pt, rightrule = 0 pt, beforeafter skip= 1em, breakable, after={\noindent}}
\newtcolorbox{frameexm}{enhanced, colback = gray!50!blue!0, borderline = {0.5pt}{0mm}{gray!90!blue},leftrule = 0pt, toprule = 0pt, bottomrule = 0pt, rightrule = 0 pt , beforeafter skip= 1em, breakable, after={\noindent}}
\newtcolorbox{framerem}{enhanced, colback = gray!50!blue!0, borderline = {0.5pt}{0mm}{gray!90!blue},leftrule = 0pt, toprule = 0pt, bottomrule = 0pt, rightrule = 0 pt , beforeafter skip= 1em, breakable, after={\noindent}}

\newenvironment{frameproof}
{\vspace{-10pt}\begin{addmargin}[12pt]{12pt}}{\end{addmargin} \vspace{10pt}}
















%############################################
%Directories and links.
%############################################

%Literature with Biblatex.
\usepackage[backend=bibtex, sorting = nyt, style=alphabetic]{biblatex} 
\usepackage{csquotes}

%Index package.
\usepackage{imakeidx}

%Literature file.
\addbibresource{Literatur.bib} 

%Fixing too long entries.
\makeatletter
\def\@idxitem{\par\hangindent 2ex}
\makeatother

%Create index.
\makeindex[intoc,options= -s index_style.ist]

%Links in pdf.
\usepackage[colorlinks=true, linkcolor=Cerulean!75!black, citecolor=green!60!black, urlcolor=Cerulean!75!black, linktocpage=true]{hyperref} 



%############################################
%Other useful packages. 
%############################################	


%Package for conditional use of \newpage: \needspace{2cm}.
\usepackage{needspace}

%Defines \FloatBarrier that blocks floating objects past the next \FloatBarrier command.
\usepackage{placeins}

%Rotate figures tables with \begin{sidewaysfigure} ... \end{sidewaysfigure} and sidewaystable...
\usepackage{rotating}

%############################################
%Useful short commands.
%############################################	
	
%Notation quantum mechanics.
\newcommand{\bra}[1]{\langle #1 |}
\newcommand{\ket}[1]{| #1 \rangle}
\newcommand{\braket}[1]{\langle #1 \rangle}
\newcommand{\Bra}[1]{\left\langle #1 \right|}
\newcommand{\Ket}[1]{\left| #1 \right\rangle}
\newcommand{\Braket}[1]{\left\langle #1 \right\rangle}

%\boxed with additional horizontal space.
\newcommand{\widebox}[1]{\boxed{\hspace{1em}#1\hspace{1em}}}



%Set front matter {title}{text}.
\newcommand{\FrontMatter}[2]{
	\frontmatter
	\newgeometry{includeheadfoot,inner=2.5cm,outer = 2.5cm ,top=1cm,bottom=1cm}	
	\include{title_page}
	\restoregeometry
	\setcounter{page}{0}
	\cleardoublepage

	\chapter*{#1}
	\addcontentsline{toc}{chapter}{#1}
	#2

	\cleardoublepage
	\tableofcontents
	\mainmatter
}




\newcommand{\FrontNoPreface}{
	\frontmatter
	\newgeometry{a4paper,includeheadfoot,inner=2.5cm,outer = 2.5cm ,top=1cm,bottom=1cm}	
	\include{title_page}
	\restoregeometry
	\setcounter{page}{0}
	\tableofcontents
	\mainmatter
}



%Keep custom packages separated from the main.tex to allow easier updates.
\input{CustomPackages.tex}





\begin{document}
	\input{content.tex}
\end{document}
